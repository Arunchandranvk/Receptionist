{% extends 'admin_home.html' %}
{% load static %}

{% block adminhome %}
<!-- Main Content Area -->
<main class="main-content min-h-screen bg-gray-100">
    <!-- Top Navigation Bar -->
    <header class="bg-white shadow-sm">
        <div class="flex justify-between items-center px-8 py-4">
            <h2 class="text-2xl font-bold text-gray-800">Enquiries Management</h2>
            <div class="flex items-center space-x-4">
                <span class="text-gray-600">{{request.user.name}}</span>
                <a href="{% url 'logout' %}" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                    Logout
                </a>
            </div>
        </div>
    </header>

    <!-- Enquiries Content -->
    <div class="p-8">
        <!-- Enquiries Table -->
        <div class="bg-white rounded-lg shadow overflow-hidden">
            <div class="px-6 py-4 border-b">
                <h3 class="text-xl font-bold">All Enquiries</h3>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Name
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Email
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Message
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Date
                            </th>
                            <th scope="col" class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                Actions
                            </th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        {% for enquiry in enquiries %}
                        <tr>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm font-medium text-gray-900">{{ enquiry.name }}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-500">{{ enquiry.email }}</div>
                            </td>
                            <td class="px-6 py-4">
                                <div class="text-sm text-gray-900 max-w-xs overflow-hidden" style="text-overflow: ellipsis; white-space: nowrap;">
                                    {{ enquiry.message|truncatechars:50 }}
                                </div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap">
                                <div class="text-sm text-gray-500">{{ enquiry.created_at|date:"d M Y, h:i a" }}</div>
                            </td>
                            <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                <button onclick="viewEnquiry('{{ enquiry.id }}', '{{ enquiry.name }}', '{{ enquiry.email }}', '{{ enquiry.message|escapejs }}', '{{ enquiry.created_at|date:"d M Y, h:i a" }}')" class="text-blue-600 hover:text-blue-900 mr-3">
                                    View
                                </button>
                                <a href="mailto:{{ enquiry.email }}" target="_blank" class="text-green-600 hover:text-green-900 mr-3">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
                                    </svg>
                                    Reply
                                </a>
                                <a href="#" onclick="confirmDelete('{{ enquiry.id }}')" class="text-red-600 hover:text-red-900">
                                    Delete
                                </a>
                            </td>
                        </tr>
                        {% empty %}
                        <tr>
                            <td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">
                                No enquiries found.
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</main>

<!-- View Enquiry Modal -->
<div id="viewEnquiryModal" class="modal">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-lg">
            <div class="flex justify-between items-center p-6 border-b">
                <h3 class="text-lg font-bold" id="modalTitle">Enquiry Details</h3>
                <button onclick="closeModal('viewEnquiryModal')" class="text-gray-500 hover:text-gray-700">
                    <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                    </svg>
                </button>
            </div>
            <div class="p-6">
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Name:</label>
                    <p id="enquiryName" class="text-gray-900"></p>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Email:</label>
                    <p id="enquiryEmail" class="text-gray-900"></p>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Date:</label>
                    <p id="enquiryDate" class="text-gray-900"></p>
                </div>
                <div class="mb-4">
                    <label class="block text-gray-700 text-sm font-bold mb-2">Message:</label>
                    <div id="enquiryMessage" class="text-gray-900 bg-gray-50 p-3 rounded"></div>
                </div>
            </div>
            <div class="px-6 py-4 border-t flex justify-end space-x-4">
                <a id="replyEmailBtn" href="#" target="_blank" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                    Reply via Email
                </a>
                <button onclick="closeModal('viewEnquiryModal')" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                    Close
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="deleteModal" class="modal">
    <div class="flex items-center justify-center min-h-screen p-4">
        <div class="bg-white rounded-lg shadow-xl w-full max-w-md">
            <div class="p-6">
                <h3 class="text-lg font-bold mb-4">Confirm Deletion</h3>
                <p class="text-gray-700">Are you sure you want to delete this enquiry? This action cannot be undone.</p>
            </div>
            <div class="px-6 py-4 border-t flex justify-end space-x-4">
                <button onclick="closeModal('deleteModal')" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                    Cancel
                </button>
                <form id="deleteForm" method="POST" action="">
                    {% csrf_token %}
                    <input type="hidden" name="enquiry_id" id="deleteEnquiryId">
                    <button type="submit" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                        Delete
                    </button>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    // Function to view enquiry details
    function viewEnquiry(id, name, email, message, date) {
        document.getElementById('enquiryName').textContent = name;
        document.getElementById('enquiryEmail').textContent = email;
        document.getElementById('enquiryMessage').textContent = message;
        document.getElementById('enquiryDate').textContent = date;
        
        // Set up the reply email button with the correct mailto link
        document.getElementById('replyEmailBtn').href = "mailto:" + email + "?subject=Re: Your Enquiry to SNGCE";
        
        // Open the modal
        document.getElementById('viewEnquiryModal').classList.add('active');
    }
    
    // Function to confirm deletion
    function confirmDelete(id) {
        document.getElementById('deleteEnquiryId').value = id;
        document.getElementById('deleteForm').action = "{% url 'delete_enquiry' %}";
        document.getElementById('deleteModal').classList.add('active');
    }
    
    // Function to close any modal
    function closeModal(modalId) {
        document.getElementById(modalId).classList.remove('active');
    }
</script>
{% endblock %}